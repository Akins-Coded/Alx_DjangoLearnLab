<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blog API - User Profile</title>
</head>
<body>
  <div class="container">
    <h1>User Profile</h1>
    <div class="new-post">
      <h2>Create a New Post</h2>
      <textarea id="newPostContent" placeholder="Write your post here..."></textarea><br>
      <button onclick="createPost()">Submit</button>
    </div>

    <h2>Your Posts</h2>
    <div id="postsContainer"></div>
  </div>

  <script>
    const API_BASE_URL = "http://127.0.0.1:8000/api/posts/"; // Replace with your DRF API endpoint
    const CSRF_TOKEN = document.querySelector('[name=csrfmiddlewaretoken]').value; // Add CSRF token for authenticated requests

    // Fetch all posts by the user
    async function fetchPosts() {
      const response = await fetch(API_BASE_URL, {
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": CSRF_TOKEN,
        },
        credentials: "include" // Include cookies for authentication
      });
      if (response.ok) {
        const posts = await response.json();
        displayPosts(posts);
      } else {
        console.error("Failed to fetch posts");
      }
    }

    // Display posts in the DOM
    function displayPosts(posts) {
      const container = document.getElementById("postsContainer");
      container.innerHTML = ""; // Clear existing posts
      posts.forEach(post => {
        const postDiv = document.createElement("div");
        postDiv.className = "post";
        postDiv.innerHTML = `
          <p><span class="math-inline">\{post\.content\}</p\>
<div class\="actions"\>
<button onclick\="editPost\(</span>{post.id}, '<span class="math-inline">\{post\.content\}'\)"\>Edit</button\>
<button onclick\="deletePost\(</span>{post.id})">Delete</button>
          </div>
        `;
        container.appendChild(postDiv);
      });
    }

    // Create a new post
    async function createPost() {
      const content = document.getElementById("newPostContent").value;
      if (!content) {
        alert("Content cannot be empty!");
        return;
      }
      const response = await fetch(API_BASE_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": CSRF_TOKEN,
        },
        credentials: "include",
        body: JSON.stringify({ content })
      });
      if (response.ok) {
        alert("Post created successfully!");
        fetchPosts();
        document.getElementById("newPostContent").value = ""; // Clear the textarea
      } else {
        alert("Failed to create post!");
      }
    }

    // Edit a post
    async function editPost(id, currentContent) {
      const newContent = prompt("Edit your post:", currentContent);
      if (newContent === null || newContent === currentContent) return;
      const response = await fetch(`<span class="math-inline">\{API\_BASE\_URL\}</span>{id}/`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": CSRF_TOKEN,
        },
        credentials: "include",
        body: JSON.stringify({ content: newContent })
      });
      if (response.ok) {
        alert("Post updated successfully!");
        fetchPosts();
      } else {
        alert("Failed to update post!");
      }
    }

    // Delete a post
    async function deletePost(id) {
      if (!confirm("Are you sure you want to delete this post?")) return;
      const response = await fetch(`<span class="math-inline">\{API\_BASE\_URL\}</span>{id}/`, {
        method: "DELETE",
        headers: {
          "X-CSRFToken": CSRF_TOKEN,
        },
        credentials: "include"
      });
      if (response.ok) {
        alert("Post deleted successfully!");
        fetchPosts();
      } else {
        alert("